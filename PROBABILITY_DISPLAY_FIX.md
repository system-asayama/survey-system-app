# 確率表示の改善レポート

## 実装日
2025-12-10

## 問題

管理画面のシンボル確率表示が分かりにくかった：
- シンボルの確率：100%（シンボル抽選時の確率）
- ハズレ確率：20%（別途表示）
- **合計：120%に見える**

ユーザーから「合計で120%になっていませんか？」という指摘を受けた。

## 原因

現在の実装では：
- **保存時**: ユーザーが入力した確率をそのまま保存（シンボル抽選時の確率）
- **スピン処理**: 
  1. まず20%の確率でハズレ判定
  2. 残り80%の中で、各シンボルを確率に基づいて抽選

つまり、確率の合計は実質100%だが、表示が分かりにくかった。

## 解決策

ヘッダーと説明を追加して、確率の意味を明確にする：

### 変更内容

#### 1. テーブルヘッダーの変更

**変更前**:
```
確率(%)
```

**変更後**:
```
抽選確率(%)*
```

#### 2. 説明の追加

テーブルの下に説明を追加：

```
* 抽選確率：ハズレでなかった場合の各シンボルの抽選確率です。実際の発生確率は「抽選確率 × (100% - ハズレ確率)」になります。
例：抽選確率10%、ハズレ確率20%の場合、実際の発生確率は 10% × 80% = 8% です。
```

#### 3. 確率計算ツールの説明を更新

**変更前**:
```
5回スピンで合計点数が指定範囲内になる確率です。
```

**変更後**:
```
5回スピンで合計点数が指定範囲内になる確率です。
※ ハズレ確率も考慮された実際の発生確率です。
```

## 実装詳細

### ファイル: `templates/admin_settings.html`

#### 変更1: テーブルヘッダー（452行目）

```html
<th style="width: 120px;">抽選確率(%)*</th>
```

#### 変更2: 説明の追加（476-479行目）

```html
<div class="help-text" style="margin-top: 12px;">
  * 抽選確率：ハズレでなかった場合の各シンボルの抽選確率です。実際の発生確率は「抽選確率 × (100% - ハズレ確率)」になります。<br>
  例：抽選確率10%、ハズレ確率20%の場合、実際の発生確率は 10% × 80% = 8% です。
</div>
```

#### 変更3: 確率計算ツールの説明（513-514行目）

```html
<p style="margin: 8px 0 0 0; color: #666; font-size: 14px;">5回スピンで合計点数が指定範囲内になる確率です。<br>
※ ハズレ確率も考慮された実際の発生確率です。</p>
```

## 確率の計算例

### 現在の設定（画像より）

- ハズレ確率: 20%
- シンボル抽選確率（合計約100%）:
  - seven: 6.4345%
  - bar: 9.2711%
  - bell: 11.5425%
  - grape: 12.2371%
  - cherry: 12.6000%
  - lemon: 12.8791%
  - GOD: 0.3464%
  - bar_reach: 12.4172%
  - seven_reach: 11.5425%
  - god_reach: 10.7295%

### 実際の発生確率

各シンボルの実際の発生確率は：

```
実際の発生確率 = 抽選確率 × (100% - ハズレ確率)
              = 抽選確率 × 80%
```

例：
- seven: 6.4345% × 80% = 5.1476%
- bar: 9.2711% × 80% = 7.4169%
- GOD: 0.3464% × 80% = 0.2771%

### 確率の合計

- ハズレ: 20%
- シンボル合計: 100% × 80% = 80%
- **全体合計: 100%** ✓

## 動作確認

### 確認項目

1. ✓ テーブルヘッダーが「抽選確率(%)*」に変更されている
2. ✓ 説明が表示されている
3. ✓ 確率計算ツールの説明が更新されている

### スクリーンショット

管理画面の設定ページで確認：
- URL: https://5000-i3gjrskfqpsj8g9tekp41-2228fcf2.manus-asia.computer/admin/settings
- 確認日時: 2025-12-10 09:35

## メリット

1. **分かりやすい**: 確率の意味が明確
2. **誤解を防ぐ**: 「120%になっている」という誤解を防ぐ
3. **計算例を提供**: 実際の発生確率の計算方法を示す

## 今後の改善案

### オプション1: 実際の発生確率を別列に表示

テーブルに「実際の発生確率(%)」列を追加：

| ID | 表示 | 配当 | 抽選確率(%) | 実際の発生確率(%) | 色 |
|----|------|------|-------------|-------------------|-----|
| seven | ７ | 100 | 6.4345 | 5.1476 | 🔴 |

### オプション2: JavaScriptで動的に計算

ハズレ確率を変更すると、実際の発生確率も自動的に更新される。

### オプション3: 確率の入力方法を変更

ユーザーが「実際の発生確率」を入力し、システムが「抽選確率」に変換する。

## コミット履歴

**コミット**: 2ed5705  
**メッセージ**: Clarify probability display in admin settings

**変更内容**:
- Changed column header from '確率(%)' to '抽選確率(%)*'
- Added explanation that displayed probability is for non-miss cases
- Added note that actual occurrence probability = lottery probability × (100% - miss probability)
- Updated probability calculator result description

## まとめ

### 実装前

- 確率の表示が分かりにくい
- 「120%になっている」という誤解

### 実装後

- 確率の意味が明確
- 計算例を提供
- 誤解を防ぐ

### 効果

- ユーザーの理解が向上
- 設定ミスを防ぐ
- システムの信頼性が向上

---

**実装者**: Manus AI Agent  
**レビュー**: 完了  
**デプロイ**: 完了（GitHub main branch）
