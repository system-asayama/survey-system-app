# 機能比較: 元のシステム vs 新しい店舗紐付けシステム

## 元のシステムの全機能

### 顧客向け機能
| 機能 | エンドポイント | 説明 |
|------|---------------|------|
| トップページ | `GET /` | アンケートページへリダイレクト |
| アンケートページ | `GET /survey` | アンケートフォーム表示 |
| アンケート送信 | `POST /submit_survey` | アンケート回答を保存 |
| 口コミ確認ページ | `GET /review_confirm` | Google口コミへの誘導 |
| スロットページ | `GET /slot` | スロット画面表示 |
| スロット回転 | `POST /spin` | スロットを5回回転 |
| デモプレイ | `GET /demo` | デモ用スロット |
| アンケートリセット | `POST /reset_survey` | セッションリセット |

### 管理者向け機能
| 機能 | エンドポイント | 説明 |
|------|---------------|------|
| 管理者ログイン | `GET/POST /admin/login` | 管理者認証 |
| 管理者ログアウト | `GET /admin/logout` | ログアウト |
| 管理ダッシュボード | `GET /admin` | 統計表示 |
| アンケート回答一覧 | `GET /admin/responses` | 回答履歴表示 |
| CSV エクスポート | `GET /admin/export/csv` | 回答データCSV出力 |
| 設定ページ | `GET/POST /admin/settings` | 各種設定画面 |
| 景品設定保存 | `POST /admin/save_prizes` | 景品設定を保存 |
| スロット設定保存 | `POST /admin/save_slot_config` | スロット確率設定を保存 |
| 確率最適化 | `POST /admin/optimize_probabilities` | 確率を自動調整 |
| アンケート編集 | `GET/POST /admin/survey/editor` | アンケート質問編集 |

### API機能
| 機能 | エンドポイント | 説明 |
|------|---------------|------|
| スロット設定取得 | `GET /config` | スロット設定JSON取得 |
| スロット設定更新 | `POST /config` | スロット設定を更新 |
| 確率計算ツール | `POST /calc_prob` | 指定範囲の確率を計算 |
| 静的ファイル | `GET /static/<path>` | 静的ファイル配信 |

---

## 新しい店舗紐付けシステムの機能

### 顧客向け機能（店舗ごと）
| 機能 | エンドポイント | 状態 |
|------|---------------|------|
| 店舗選択ページ | `GET /` | ✅ 実装済み |
| 店舗トップ | `GET /store/<slug>/` | ✅ 実装済み |
| アンケートページ | `GET /store/<slug>/survey` | ✅ 実装済み |
| アンケート送信 | `POST /store/<slug>/submit_survey` | ⚠️ 要確認 |
| 口コミ確認ページ | `GET /store/<slug>/review_confirm` | ✅ 実装済み |
| スロットページ | `GET /store/<slug>/slot` | ✅ 実装済み |
| スロット回転 | `POST /store/<slug>/spin` | ✅ 実装済み |
| スロット設定取得 | `GET /store/<slug>/config` | ✅ 実装済み |
| 確率計算 | `POST /store/<slug>/calc_prob` | ✅ 実装済み |

### 管理者向け機能
| 機能 | エンドポイント | 状態 |
|------|---------------|------|
| ログイン選択 | `GET /select_login` | ✅ 実装済み（既存） |
| 管理者ログイン | `GET/POST /admin_login` | ✅ 実装済み（既存） |
| 管理ダッシュボード | `GET /admin/` | ✅ 実装済み（既存） |
| 店舗情報表示 | `GET /admin/store_info` | ✅ 実装済み（既存） |
| 店舗設定トップ | `GET /admin/store_settings/` | ✅ 実装済み（新規） |
| 景品設定 | `GET /admin/store_settings/<id>/prizes` | ✅ 実装済み（新規） |
| Google口コミURL設定 | `GET /admin/store_settings/<id>/google_review` | ✅ 実装済み（新規） |
| **アンケート回答一覧** | ❌ **未実装** | ❌ 移植必要 |
| **CSV エクスポート** | ❌ **未実装** | ❌ 移植必要 |
| **スロット設定保存** | ❌ **未実装** | ❌ 移植必要 |
| **確率最適化** | ❌ **未実装** | ❌ 移植必要 |
| **アンケート編集** | ❌ **未実装** | ❌ 移植必要 |

---

## 不足している機能（移植が必要）

### 優先度：高
1. **アンケート回答一覧** (`/admin/responses`)
   - 店舗ごとのアンケート回答を表示
   - フィルタリング機能
   - ページネーション

2. **CSV エクスポート** (`/admin/export/csv`)
   - 店舗ごとのアンケート回答をCSV出力
   - 日付範囲指定

3. **スロット設定画面** (`/admin/settings`)
   - スロット確率設定UI
   - 景品設定UI（既に実装済み）
   - Google口コミURL設定（既に実装済み）

### 優先度：中
4. **スロット設定保存** (`/admin/save_slot_config`)
   - スロット確率を保存
   - 店舗ごとに設定

5. **確率最適化** (`/admin/optimize_probabilities`)
   - 期待値に基づいて確率を自動調整
   - 店舗ごとに設定

### 優先度：低
6. **アンケート編集** (`/admin/survey/editor`)
   - アンケート質問のカスタマイズ
   - 店舗ごとに設定

7. **デモプレイ** (`/demo`)
   - デモ用スロット
   - 店舗ごとに設定

---

## 結論

**移植されていない重要な機能:**
1. ❌ アンケート回答一覧
2. ❌ CSV エクスポート
3. ❌ スロット設定画面（確率設定UI）
4. ❌ 確率最適化
5. ❌ アンケート編集

**移植済みの機能:**
1. ✅ 顧客向けアンケート・スロット機能
2. ✅ 景品設定
3. ✅ Google口コミURL設定
4. ✅ 基本的な管理画面

**次のステップ:**
不足している機能を優先度順に実装する必要があります。
