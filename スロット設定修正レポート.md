# スロット設定ページ修正レポート

## 問題の概要

ユーザーから「デフォルトの状態でスロット設定を保存ボタンを押すと、一部のシンボルが削除される」という報告を受けました。

### 具体的な症状

1. **スロット設定ページで6個のシンボルしか表示されない**
   - 表示されるシンボル: seven, bar, bell, grape, cherry, lemon
   - 欠落するシンボル: GOD, bar_reach, seven_reach, god_reach

2. **全ての抽選確率が0.0000%と表示される**（修正前の誤った修正で発生）

3. **データベースには正しいデータが保存されている**
   - 10個のシンボル
   - 正しい確率（seven: 3.3469%, bar: 6.8371%, など）

## 根本原因

`store_slot_settings_routes.py`の`store_slot_settings`関数（210-212行目）で、**間違ったカラムをJSONパースしていた**ことが原因でした。

### 問題のコード（修正前）

```python
if slot_row and slot_row[0]:
    try:
        slot_config_dict = json.loads(slot_row[0])
```

### 問題点

- `slot_row[0]`は`id`カラム（整数）
- `slot_row[1]`が`config_json`カラム（JSON文字列）
- 整数をJSONパースしようとして失敗
- `except`ブロックで`_default_config()`が呼ばれる
- `_default_config()`は6個のシンボルしか定義していない

## 修正内容

### 修正したファイル

`store_slot_settings_routes.py`（210-212行目）

### 修正後のコード

```python
if slot_row and slot_row[1]:
    try:
        slot_config_dict = json.loads(slot_row[1])
```

### 変更点

- `slot_row[0]` → `slot_row[1]`に変更
- これにより、正しいJSON文字列をパースできるようになった

## 修正結果

### 修正前

| 項目 | 状態 |
|---|---|
| シンボル数 | 6個 |
| 抽選確率 | 正しく表示 |
| GOD、リーチシンボル | 欠落 |

### 修正後

| 項目 | 状態 |
|---|---|
| シンボル数 | 10個 ✅ |
| 抽選確率 | 正しく表示 ✅ |
| GOD、リーチシンボル | 正しく表示 ✅ |
| 保存後の状態 | 正しく保持 ✅ |

## 動作確認

1. ✅ スロット設定ページで10個のシンボルが表示される
2. ✅ 全ての確率が正しく表示される（seven: 3.3469%, bar: 6.8371%, など）
3. ✅ GOD、bar_reach、seven_reach、god_reachが表示される
4. ✅ 「スロット設定を保存」ボタンを押しても設定が保持される
5. ✅ ページをリロードしても設定が保持される

## GitHubプッシュ

- **コミットID**: `debd0b3`
- **ブランチ**: `main`
- **リポジトリ**: `system-asayama/survey-system-app`

## まとめ

**問題の原因は、データベースクエリ結果の間違ったカラムをJSONパースしていたことでした。**

この修正により：
- 全てのシンボル（10個）が正しく表示される
- 全ての確率が正しく表示される
- 保存後も設定が正しく保持される

**スロット設定機能が完全に動作するようになりました！** 🎰✨
