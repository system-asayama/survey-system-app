<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å£ã‚³ãƒŸæŠ•ç¨¿ä¿ƒé€²è¨­å®š - {{ store.name }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #2196F3;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .flash-messages {
            margin-bottom: 20px;
        }
        .flash {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .flash.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .flash.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .setting-section {
            margin-bottom: 30px;
        }
        .setting-item {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .setting-item:hover {
            border-color: #2196F3;
        }
        .setting-item.selected {
            border-color: #4CAF50;
            background: #f0f8f0;
        }
        .setting-item.risky {
            border-color: #ff9800;
        }
        .setting-item.risky.selected {
            border-color: #f44336;
            background: #fff3f3;
        }
        .setting-item input[type="radio"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .setting-item label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        .badge-success {
            background: #4CAF50;
            color: white;
        }
        .badge-danger {
            background: #f44336;
            color: white;
        }
        .setting-description {
            margin-top: 15px;
            padding-left: 30px;
            font-size: 14px;
            line-height: 1.8;
        }
        .setting-description.text-success {
            color: #2e7d32;
        }
        .setting-description.text-danger {
            color: #c62828;
        }
        .info-box {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .info-box h3 {
            color: #0066cc;
            font-size: 18px;
            margin-bottom: 15px;
        }
        .info-box ul {
            list-style: none;
            padding-left: 0;
        }
        .info-box li {
            padding: 8px 0;
            color: #333;
            font-size: 14px;
            line-height: 1.6;
        }
        .info-box li:before {
            content: "âœ… ";
            margin-right: 8px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
            font-weight: 600;
        }
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        .btn-primary:hover {
            background: #45a049;
        }
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border-radius: 8px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .modal-header {
            background: #f44336;
            color: white;
            padding: 20px 30px;
            border-radius: 8px 8px 0 0;
        }
        .modal-header h2 {
            margin: 0;
            font-size: 24px;
        }
        .modal-body {
            padding: 30px;
        }
        .modal-body p {
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 20px;
            color: #333;
        }
        .modal-body strong {
            color: #f44336;
        }
        .risk-list {
            margin: 20px 0;
        }
        .risk-list h4 {
            color: #f44336;
            font-size: 18px;
            margin: 20px 0 10px 0;
        }
        .risk-list ul {
            list-style: none;
            padding-left: 0;
        }
        .risk-list li {
            padding: 8px 0 8px 25px;
            position: relative;
            color: #333;
            font-size: 15px;
        }
        .risk-list li:before {
            content: "âŒ";
            position: absolute;
            left: 0;
        }
        .warning-note {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
            font-size: 15px;
            line-height: 1.6;
        }
        .checkbox-group {
            margin: 25px 0;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .checkbox-group label {
            display: block;
            padding: 12px 0;
            cursor: pointer;
            font-size: 15px;
        }
        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-danger {
            background: #f44336;
            color: white;
        }
        .btn-danger:hover {
            background: #da190b;
        }
        .btn-danger:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .separator {
            border-top: 2px solid #ddd;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="{{ url_for('store_settings_index') }}" class="back-link">â† åº—èˆ—è¨­å®šã«æˆ»ã‚‹</a>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <h1>å£ã‚³ãƒŸæŠ•ç¨¿ä¿ƒé€²è¨­å®š</h1>
        <div class="subtitle">{{ store.name }}</div>
        
        <div class="info-box">
            <h3>ğŸ“Œ ã“ã®è¨­å®šã«ã¤ã„ã¦</h3>
            <p style="color: #333; margin-bottom: 15px;">
                ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”å¾Œã€ã©ã®è©•ä¾¡ã®ãŠå®¢æ§˜ã«å¯¾ã—ã¦Googleå£ã‚³ãƒŸæŠ•ç¨¿ã‚’ä¿ƒã™ã‹ã‚’è¨­å®šã—ã¾ã™ã€‚
            </p>
            <ul>
                <li>Googleãƒãƒªã‚·ãƒ¼ã«æº–æ‹ </li>
                <li>ã‚¹ãƒ†ãƒè¦åˆ¶æ³•ã«æº–æ‹ </li>
                <li>ãŠå®¢æ§˜ã®ãƒ“ã‚¸ãƒã‚¹ã‚’å®ˆã‚‹ãŸã‚</li>
                <li>é•·æœŸçš„ã«ä¿¡é ¼ã•ã‚Œã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æä¾›ã™ã‚‹ãŸã‚</li>
            </ul>
        </div>
        
        <form method="POST" action="{{ url_for('store_settings_save_review_prompt', store_id=store.id) }}" id="settingsForm">
            <div class="setting-section">
                <div class="setting-item {% if review_prompt_mode == 'all' %}selected{% endif %}" onclick="selectOption('all')">
                    <label>
                        <input type="radio" name="review_prompt_mode" value="all" {% if review_prompt_mode == 'all' %}checked{% endif %}>
                        å…¨ã¦ã®è©•ä¾¡ã«å¯¾ã—ã¦æŠ•ç¨¿ã‚’ä¿ƒã™
                        <span class="badge badge-success">æ¨å¥¨</span>
                    </label>
                    <div class="setting-description text-success">
                        âœ… Googleãƒãƒªã‚·ãƒ¼ã«æº–æ‹ <br>
                        âœ… ã‚¹ãƒ†ãƒè¦åˆ¶æ³•ã«æº–æ‹ <br>
                        âœ… ãƒªã‚¹ã‚¯ãªã—<br>
                        âœ… æŒç¶šå¯èƒ½<br>
                        âœ… ä½è©•ä¾¡ã¯æ”¹å–„ã®æ©Ÿä¼š
                    </div>
                </div>
                
                <div class="setting-item risky {% if review_prompt_mode == 'high_rating_only' %}selected{% endif %}" onclick="selectOption('high_rating_only')">
                    <label>
                        <input type="radio" name="review_prompt_mode" value="high_rating_only" {% if review_prompt_mode == 'high_rating_only' %}checked{% endif %}>
                        æ˜Ÿ4ä»¥ä¸Šã®ã¿æŠ•ç¨¿ã‚’ä¿ƒã™
                        <span class="badge badge-danger">âš ï¸ éæ¨å¥¨ãƒ»ãƒªã‚¹ã‚¯ã‚ã‚Š</span>
                    </label>
                    <div class="setting-description text-danger">
                        âŒ Googleãƒãƒªã‚·ãƒ¼é•å<br>
                        âŒ ãƒšãƒŠãƒ«ãƒ†ã‚£ã®ãƒªã‚¹ã‚¯<br>
                        âŒ ã‚¹ãƒ†ãƒè¦åˆ¶æ³•é•åã®å¯èƒ½æ€§<br>
                        âŒ ç¤¾ä¼šçš„ä¿¡ç”¨ã®å¤±å¢œãƒªã‚¹ã‚¯
                    </div>
                </div>
            </div>
            
            <button type="button" class="btn btn-primary" onclick="saveSettings()">è¨­å®šã‚’ä¿å­˜</button>
        </form>
    </div>
    
    <!-- è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="warningModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš ï¸ é‡è¦ãªè­¦å‘Š</h2>
            </div>
            <div class="modal-body">
                <p>ã€Œæ˜Ÿ4ä»¥ä¸Šã®ã¿æŠ•ç¨¿ã‚’ä¿ƒã™ã€è¨­å®šã¯ã€<br>
                <strong>Googleã®ãƒãƒªã‚·ãƒ¼ã«æ˜ç¢ºã«é•åã—ã¾ã™ã€‚</strong></p>
                
                <div class="separator"></div>
                
                <h3 style="color: #333; font-size: 20px; margin-bottom: 15px;">ä»¥ä¸‹ã®ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã“ã¨ã‚’ç†è§£ã—ã¦ãã ã•ã„ï¼š</h3>
                
                <div class="risk-list">
                    <h4>1. Googleã«ã‚ˆã‚‹ãƒšãƒŠãƒ«ãƒ†ã‚£</h4>
                    <ul>
                        <li>å…¨ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®éå…¬é–‹åŒ–</li>
                        <li>æ–°è¦ãƒ¬ãƒ“ãƒ¥ãƒ¼å—ä»˜åœæ­¢</li>
                        <li>è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤ºã€Œã“ã®ãƒ“ã‚¸ãƒã‚¹ã¯ä¸æ­£ã‚’ã—ã¦ã„ã¾ã™ã€</li>
                        <li>ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®å‰Šé™¤</li>
                    </ul>
                    
                    <h4>2. ã‚¹ãƒ†ãƒè¦åˆ¶æ³•é•å</h4>
                    <ul>
                        <li>æªç½®å‘½ä»¤</li>
                        <li>ç½°é‡‘ï¼ˆæœ€å¤§300ä¸‡å††ï¼‰</li>
                        <li>ç¤¾åå…¬è¡¨</li>
                        <li>ãƒ¡ãƒ‡ã‚£ã‚¢å ±é“</li>
                    </ul>
                    
                    <h4>3. ç¤¾ä¼šçš„ä¿¡ç”¨ã®å¤±å¢œ</h4>
                    <ul>
                        <li>ãƒ¡ãƒ‡ã‚£ã‚¢ã§å ±é“ã•ã‚Œã‚‹</li>
                        <li>SNSã§æ‹¡æ•£ã•ã‚Œã‚‹</li>
                        <li>é¡§å®¢ãŒé›¢ã‚Œã‚‹</li>
                        <li>å£²ä¸ŠãŒæ¸›å°‘ã™ã‚‹</li>
                    </ul>
                </div>
                
                <div class="separator"></div>
                
                <p class="warning-note">
                    <strong>ã€é‡è¦ã€‘</strong><br>
                    ã“ã‚Œã‚‰ã®ãƒªã‚¹ã‚¯ã¯ã€Œå¯èƒ½æ€§ã€ã§ã¯ãªãã€<strong>å®Ÿéš›ã«ç™ºç”Ÿã—ã¦ã„ã¾ã™</strong>ã€‚<br>
                    <br>
                    2024å¹´6æœˆã€æ±äº¬éƒ½å†…ã®åŒ»ç™‚æ³•äººãŒã€Œæ˜Ÿ4ä»¥ä¸Šã§å‰²å¼•ã€ã§æ™¯å“è¡¨ç¤ºæ³•é•åã«ã‚ˆã‚Šæªç½®å‘½ä»¤ã‚’å—ã‘ã¾ã—ãŸã€‚<br>
                    <br>
                    å¤šãã®ã‚·ã‚¹ãƒ†ãƒ ãŒåŒæ§˜ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã¾ã™ãŒã€ãã‚Œã¯ã€Œå®‰å…¨ã€ã‚’æ„å‘³ã—ã¾ã›ã‚“ã€‚<br>
                    è¦åˆ¶ã¯å¾Œã‹ã‚‰å¼·åŒ–ã•ã‚Œã¾ã™ã€‚ã€Œä»Šã¯å¤§ä¸ˆå¤«ã€ã§ã‚‚ã€Œå°†æ¥ã¯å±é™ºã€ã§ã™ã€‚
                </p>
                
                <div class="separator"></div>
                
                <div class="checkbox-group">
                    <p style="margin-bottom: 15px; font-weight: 600; color: #333;">ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š</p>
                    <label>
                        <input type="checkbox" id="understand1">
                        ä¸Šè¨˜ã®ãƒªã‚¹ã‚¯ã‚’ååˆ†ã«ç†è§£ã—ã¾ã—ãŸ
                    </label>
                    <label>
                        <input type="checkbox" id="understand2">
                        å…¨ã¦ã®è²¬ä»»ã‚’è‡ªåˆ†ã§è² ã„ã¾ã™
                    </label>
                    <label>
                        <input type="checkbox" id="understand3">
                        ã‚·ã‚¹ãƒ†ãƒ æä¾›è€…ã«ä¸€åˆ‡ã®è²¬ä»»ã‚’æ±‚ã‚ã¾ã›ã‚“
                    </label>
                </div>
                
                <div class="modal-buttons">
                    <button class="btn btn-secondary" onclick="cancelRiskySettings()">
                        å®‰å…¨ãªè¨­å®šã«æˆ»ã‚‹
                    </button>
                    <button class="btn btn-danger" id="confirmRiskyBtn" disabled onclick="confirmRiskySettings()">
                        ãã‚Œã§ã‚‚ä½¿ç”¨ã™ã‚‹
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function selectOption(value) {
            document.querySelectorAll('input[name="review_prompt_mode"]').forEach(radio => {
                radio.checked = (radio.value === value);
            });
            updateSelectedStyles();
        }
        
        function updateSelectedStyles() {
            document.querySelectorAll('.setting-item').forEach(item => {
                const radio = item.querySelector('input[type="radio"]');
                if (radio.checked) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }
        
        function saveSettings() {
            const mode = document.querySelector('input[name="review_prompt_mode"]:checked').value;
            
            if (mode === 'high_rating_only') {
                // è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
                document.getElementById('warningModal').style.display = 'block';
            } else {
                // å®‰å…¨ãªè¨­å®šãªã®ã§å³åº§ã«ä¿å­˜
                document.getElementById('settingsForm').submit();
            }
        }
        
        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ç›£è¦–
        document.querySelectorAll('#warningModal input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const allChecked = 
                    document.getElementById('understand1').checked &&
                    document.getElementById('understand2').checked &&
                    document.getElementById('understand3').checked;
                
                document.getElementById('confirmRiskyBtn').disabled = !allChecked;
            });
        });
        
        function confirmRiskySettings() {
            // ãƒ•ã‚©ãƒ¼ãƒ ã«è­¦å‘Šç¢ºèªãƒ•ãƒ©ã‚°ã‚’è¿½åŠ 
            const form = document.getElementById('settingsForm');
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'warnings_confirmed';
            input.value = 'true';
            form.appendChild(input);
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡
            form.submit();
        }
        
        function cancelRiskySettings() {
            // å®‰å…¨ãªè¨­å®šã«æˆ»ã™
            selectOption('all');
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            document.getElementById('warningModal').style.display = 'none';
            
            // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('understand1').checked = false;
            document.getElementById('understand2').checked = false;
            document.getElementById('understand3').checked = false;
        }
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        window.onclick = function(event) {
            const modal = document.getElementById('warningModal');
            if (event.target == modal) {
                cancelRiskySettings();
            }
        }
        
        // åˆæœŸåŒ–
        updateSelectedStyles();
    </script>
</body>
</html>
